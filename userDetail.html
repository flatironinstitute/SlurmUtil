<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap"
      rel="stylesheet"
    />

    <link rel="stylesheet" href="/static/css/normalize.css" />
    <link rel="stylesheet" href="/static/css/style2.css" />

    <title>User Detail | {uname}</title>
    <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
    <script type="text/javascript" src="static/scripts/jquery.min.js"></script>
    <script type="text/javascript" src="static/scripts/myFunc.js"></script>
    <script type="text/javascript" src="static/scripts/myTable.js"></script>
    <script type="text/javascript">

      $(document).ready(function(){{
          // Add menus
          $("#navmenu").load("/getHeader?page=index");
          var thisPath = window.location.pathname;
          $('#crumbmenu').load('/getBreadcrumbs?path=' + thisPath);

          //create table job_table and part_table
          var r_j_titles     = {{'job_id':'Job ID', 'name':'Job Name', 'partition':'Partition', 'nodes':'Nodes', 'submit_time':'Submit Time', 'start_time':'Start Time', 'tres_req_str':'Tres Req', 'tres_alloc_str':'Tres Alloc', 'command':'Command'}}
          var p_j_titles     = {{'job_id':'Job ID', 'partition':'Partition', 'name':'Job Name', 'submit_time':'Submit Time', 'tres_req_str':'Tres Req', 'state_reason':'Pending Reason'}}
          var job_type_dict  = {{'job_id':'job', 'partition':'partition','name':'job_name', 'submit_time':'timestamp','start_time':'timestamp', 'tres_req_str':'TresShort', 'tres_alloc_str':'TresShort'}}
          var u_fields_title = {{'uid':'User ID', 'Account':'Account', 'MaxSubmit':'Max Submit', 'MaxJobs':'Max Jobs', 'MaxNodes':'Max Nodes', 'MaxCPUs':'Max CPUs', 'MaxWall':'Max Wall Time', 'MaxCPUMins':'Max CPU min', 
                                 'tres_alloc_str':'Alloc TRES', 
                                 'tres_usage':'TRES YTD Time',
                                 'file_usage':'<a href="user_fileReport?uid={uid}&days=30">File Usage</a>', 
                                 'partitions':'<a href="#div_partition">Avail Partitions</a>','running_jobs':'<a href="#div_running_job">Running Jobs<a>','pending_jobs':'<a href="#div_pending_job">Pending Jobs<a>'}}
          var running_jobs   = {running_jobs}
          var pending_jobs   = {pending_jobs}
          var part_info      = {part_info}
          var job_history    = {job_history}
          var user_assoc     = {user_assoc}
          var array_het_jids = {array_het_jids}
          console.log("array_het_jids=", array_het_jids)

          createNoHeaderTable (user_assoc, u_fields_title, {{'running_jobs':'job_list_summary','pending_jobs':'job_list_summary','tres_usage':'tres_usage'}}, '#div_user_info', 'job_info')
          if (running_jobs.length >0) {{
             createTable (running_jobs, r_j_titles, 'run_job_table',  'div_running_job', undefined, job_type_dict);
          }}
          if (pending_jobs.length >0) {{
             createTable (pending_jobs, p_j_titles, 'pend_job_table', 'div_pending_job',undefined, job_type_dict);
          }}

          createUserPartTable   (part_info,   'part_table',     'div_partition')
          createJobHistoryTable (job_history, array_het_jids, 'job_history_table', 'past_job')

          $("#running_jobs_len").text(running_jobs.length)
          $("#pending_jobs_len").text(pending_jobs.length)
          $("#part_len").text        (part_info.length)
          $("#job_history_len").text (job_history.length)

          //$('.table_title + table').hide()
          $('.table_title').toggleClass('table_title_collapse')
          $('.table_title').next().toggleClass('hide')
          $('.table_title').click(function(event) {{
             //$(this).children("i").toggleClass('hide')
             $(this).toggleClass('table_title_collapse')
             $(this).next().toggleClass('hide')
          }});

          if (user_assoc['alloc_gpus'])
             $("#gpu_link").html (", <a href='userGPUGraph?user={uname}'>GPU Usage Graph </a>")
      }});
    </script>
  </head>

  <body>
    <div class="layout">
      <div class="stickynav">
        <div class="stickynav__inner">
          <div class="stickynav__content">
            <div class="stickynav__logo">
              <a href="/" class="hero__title hero__title--crumb">Slurm Util</a>
            </div>
            <div class="stickynav__update">Updated: {update_time}</div>
          </div>
        </div>
      </div>
      <nav class="nav" id="navmenu"></nav>
      <section class="section">
        <div class="section__inner section__inner--fullwidth">
          <div class="section__div">
            <h3>
              {user}:
            </h3>
            <div id="div_user_info"></div>
          </div>
        </div>
      </section>
      <section class="section">
        <div class="section__inner section__inner--fullwidth">
          <div class="section__div" id="div_running_job">
            <h3 class="table_title">Total <span id="running_jobs_len"></span> Running Jobs
                (<a href="userJobGraph?user={uname}">Resource Usage</a>
                <span id="gpu_link"></span>)
            </h3>
          </div>
        </div>
      </section>
      <section class="section">
        <div class="section__inner section__inner--fullwidth">
          <div class="section__div" id="div_pending_job">
            <h3 class="table_title">Total <span id="pending_jobs_len"></span> Pending Jobs</h3>
          </div>
        </div>
      </section>
      <section class="section">
        <div class="section__inner section__inner--fullwidth">
          <div class="section__div" id="div_partition">
            <h3 class="table_title">Total <span id="part_len"></span> Partitions</h3>
          </div>
        </div>
      </section>
      <section class="section">
        <div class="section__inner section__inner--fullwidth">
          <div class="section__div" id="past_job">
            <h3 class="table_title">Total <span id="job_history_len"></span> Finished Jobs during Last {day_cnt} Days</h3>
            <!-- <p>You can change the number of days by adding/changing the parameter "days" in the address such as http://scclin011:8126/userDetails?user=uname<span color="green">&days=7</span> -->
          </div>
        </div>
      </section>
    </div>
    <footer class="section section--footer">
      <div class="section__inner section__inner--footer">
        <a href="/" class="hero__title hero__title--footer">Slurm Util</a>
      </div>
    </footer>
  </body>
</html>
