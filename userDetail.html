<!DOCTYPE html>
<html>

<head>
<meta charset='UTF-8'>
<title>User Detail</title>
<link rel="stylesheet" href="/static/css/style.css">

<script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
<script type="text/javascript" src="static/scripts/jquery.min.js"></script>
<script type="text/javascript" src="static/scripts/myTable.js"></script>
<script type="text/javascript" src="static/scripts/myList.js"></script>
<script type="text/javascript">

$(document).ready(function(){{
    //create table job_table and part_table
    var r_j_titles     = {{'job_id':'Job ID', 'partition':'Partition', 'name':'Job Name', 'submit_time':'Submit Time', 'start_time':'Start Time', 'nodes':'Nodes', 'tres_req_str':'Tres Req', 'tres_alloc_str':'Tres Alloc', 'command':'Command', 'work_dir':'Work Dir'}}
    var p_j_titles     = {{'job_id':'Job ID', 'partition':'Partition', 'name':'Job Name', 'submit_time':'Submit Time', 'tres_req_str':'Tres Req', 'state_reason':'Pending Reason', 'state_exp':'Note'}}
    var part_titles    = {{'name': 'Part.', 'flag_shared':'Sharable', 
                           'user_lmt_nodes'  :'Node', 'user_lmt_cpus'  :'CPU', 'user_lmt_gpus'  :'GPU',
                           'user_alloc_nodes':'Node', 'user_alloc_cpus':'CPU', 'user_alloc_gpus':'GPU',
                           'user_avail_nodes':'Node', 'user_avail_cpus':'CPU', 'user_avail_gpus': 'GPU',
                           'grp_lmt_nodes'   :'Node', 'grp_lmt_cpus'   :'CPU', 'grp_lmt_gpus'   :'GPU',
                           'grp_alloc_nodes' :'Node', 'grp_alloc_cpus' :'CPU', 'grp_alloc_gpus' :'GPU',
                           'total_nodes'     :'Node', 'total_cpus'     :'CPU', 'total_gpus'     :'GPU', 
                           'avail_nodes_cnt' :'Node', 'avail_cpus_cnt' :'CPU', 'avail_gpus_cnt' :'GPU', 
                         }}
    var j_h_titles     = {{'JobID':'Job ID', 'JobName':'Name','AllocCPUS':'Alloc CPU','State':'State','ExitCode':'Exit Code','NodeList':'Alloc Node','Start':'Start','End':'End'}}
    var part_type_dict = {{'name':'Partition'}}
    var job_type_dict  = {{'JobName':'JobName', 'name':'JobName', 'submit_time':'Time','start_time':'Time', 'tres_req_str':'TresShort', 'tres_alloc_str':'TresShort'}}
    var jr_type_dict   = {{'JobID':'JobAndStep', 'JobIDRaw':'JobAndStep'}}
    var u_fields_title = {{'uid':'User ID', 'Account':'Account', 'MaxSubmit':'Max Submit', 'MaxJobs':'Max Jobs', 'MaxNodes':'Max Nodes', 'MaxCPUs':'Max CPUs', 'MaxWall':'Max Wall Time', 'MaxCPUMins':'Max CPU min', 'alloc_nodes':'Alloc Nodes', 'alloc_cpus':'Alloc CPUs', 'alloc_mem':'Alloc Mem'}}
    var running_jobs   = {running_jobs}
    var pending_jobs   = {pending_jobs}
    var part_info      = {part_info}
    var job_history    = {job_history}
    var user_assoc     = {user_assoc}
    var array_het_jids = {array_het_jids}

    createList (user_assoc, u_fields_title, '#user_assoc')
    //createList (user_assoc, ['uid', 'Account', 'MaxJobs', 'MaxNodes', 'MaxCPUs', 'MaxSubmit', 'MaxWall', 'MaxCPUMins', 'alloc_nodes', 'alloc_cpus', 'alloc_mem'], '#user_assoc')
    if (running_jobs.length >0) {{
       createTable (running_jobs, r_j_titles, 'run_job_table',  'running_jobs', undefined, job_type_dict);
    }}
    if (pending_jobs.length >0) {{
       createTable (pending_jobs, p_j_titles, 'pend_job_table',  'pending_jobs',undefined, job_type_dict);
    }}
    createTable (part_info,     part_titles,  'part_table',        'qos_part', undefined, part_type_dict)
    $('#part_table thead').prepend('<tr><th colspan="2"></th><th colspan="3">User Lmt</th><th colspan="3">User Alloc</th><th colspan="3">User Avail</th><th colspan="3">Grp Lmt</th><th colspan="3">Grp Alloc</th><th colspan="3">Part. Total</th><th colspan="3">Part. Avail</th></tr>')
    if (array_het_jids) {{
       j_h_titles     = {{'JobIDRaw':'Job ID', 'job_id':'Job ID(Report)', 'JobName':'Name','AllocCPUS':'Alloc CPU','State':'State','ExitCode':'Exit Code','NodeList':'Alloc Node','Start':'Start','End':'End'}}
       jr_type_dict   = {{'JobIDRaw':'JobAndStep'}}
    }}
    createTable (job_history, j_h_titles,  'job_history_table', 'past_job', undefined, jr_type_dict) 

    $("#running_jobs_len").text(running_jobs.length)
    $("#pending_jobs_len").text(pending_jobs.length)
    $("#part_len").text(part_info.length)
    $("#job_history_len").text(job_history.length)

    //$('.table_title + table').hide()
    $('.table_title').click(function(event) {{
       console.log('click', this)
       //$(this).children("i").toggleClass('hide')
       $(this).toggleClass('table_title_collapse')
       $(this).next().toggleClass('hide')
    }});
}});
</script>
</head>

<body>
<div id="user" class="page-wrap">
  <h3> {user} ({uname}): 
    <a href='userJobGraph?uname={uname}'>Usage Graph</a>,
    <a href='user_fileReport?user={uname}&days=30'>File Usage Report</a>
  </h3>
  <p><i>Update time: {update_time}</i>
  <hr>
</div>
<div id="user_assoc">
</div>
<div id="qos_part" class="page-wrap">
  <h3 class="table_title">Total <font id="part_len"></font> Available Partitions</h3>
</div>
<div id="running_jobs" class="page-wrap">
  <h3 class="table_title">Total <font id="running_jobs_len"></font> Running Jobs</h3>
</div>
<div id="pending_jobs" class="page-wrap">
  <h3 class="table_title">Total <font id="pending_jobs_len"></font> Pending Jobs</h3>
</div>
<div id="past_job" class="page-wrap">
  <h3 class="table_title">Total <font id="job_history_len"></font>  Jobs of Last {day_cnt} Days of User</h3>
<!--   <p>You can change the number of days by adding/changing the parameter "days" in the address such as http://scclin011:8126/userDetails?user=uname<font color="green">&days=7</font>
-->
</div>
</body>

</html>
