<!DOCTYPE html>
<html>

<head>
<meta charset='UTF-8'>
<title>Pending Jobs</title>
    <link rel="stylesheet" href="/static/css/style.css">

<script src="http://code.jquery.com/jquery-1.12.4.min.js"></script>
<script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
    <script>
       $(function(){{
          $("#tabmenu").load("/getHeader?page=pending")
       }});</script>

<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<!--[if !IE]><!-->
	<style>
	* {{ 
	  margin: 0; 
	  padding: 0; 
     }}
     body {{ 
	   font: 14px/1.4 Georgia, Serif; 
     }}
    .page-wrap {{
	  margin: 50px;
    }}
    p {{
	 margin: 20px 0; 
    }}

	/* 
	Generic Styling, for Desktops/Laptops 
	*/
	table {{ 
		width: 100%; 
		border-collapse: collapse; 
	}}
	/* Zebra striping */
	tr:nth-of-type(odd) {{ 
		background: #eee; 
	}}
	th {{ 
		background: #333; 
		color: white; 
		font-weight: bold; 
		cursor: s-resize;
		background-repeat: no-repeat;
        background-position: 3% center;
	}}
	td, th {{ 
		padding: 6px; 
		border: 1px solid #ccc; 
		text-align: left; 
	}}
	
	th.des:after {{
      content: "\21E9";
    }}
    
    th.aes:after {{
      content: "\21E7";
    }}
	
	/* 
	Max width before this PARTICULAR table gets nasty
	This query will take effect for any screen smaller than 760px
	and also iPads specifically.
	*/
	@media 
	only screen and (max-width: 760px),
	(min-device-width: 768px) and (max-device-width: 1024px)  {{
	
		/* Force table to not be like tables anymore */
		table, thead, tbody, th, td, tr {{ 
			display: block; 
		}}
		
		/* Hide table headers (but not display: none;, for accessibility) */
		thead tr {{ 
			position: absolute;
			top: -9999px;
			left: -9999px;
		}}
		
		tr {{ border: 1px solid #ccc; }}
		
		td {{ 
			/* Behave  like a "row" */
			border: none;
			border-bottom: 1px solid #eee; 
			position: relative;
			padding-left: 50%; 
		}}
		
		td:before {{ 
			/* Now like a table header */
			position: absolute;
			/* Top/left values mimic padding */
			top: 6px;
			left: 6px;
			width: 45%; 
			padding-right: 10px; 
			white-space: nowrap;
		}}
		
		/*
		Label the data
		*/
		td:before {{
		  content: attr(data-th) ": ";
          font-weight: bold;
          width: 6.5em;
          display: inline-block;
		}}
	}}
	
	/* Smartphones (portrait and landscape) ----------- */
	@media only screen
	and (min-device-width : 320px)
	and (max-device-width : 480px) {{
		body {{ 
			padding: 0; 
			margin: 0; 
			width: 320px; }}
		}}
	
	/* iPads (portrait and landscape) ----------- */
	@media only screen and (min-device-width: 768px) and (max-device-width: 1024px) {{
		body {{ 
			width: 495px; 
		}}
	}}
	</style>
	<!--<![endif]-->
</head>

<body>
<div class="tab" id="tabmenu"></div>

<div id="pending_jobs" class="page-wrap">
<h1>Pending Jobs</h1>
Update time: {update_time}
<!--<p>Click the table header to sort data according to that column</p>
-->
</div>
<div id="partitions" class="page-wrap">
<h1>Partitions</h1>
</div>



<script type="text/javascript">
    var pending_jobs = {pending_jobs_input}
    var partitions   = {partitions_input}

    var j_titles     = {{'job_id':'Job', 'submit_time_str':'Submit Time', 'num_nodes':'Req Node', 'num_cpus':'Req CPU', 'user':'User', 'account':'Account', 'partition':'Req Part.', 'state_reason':'Pending Reason', 'state_exp':'Note'}}
    var p_titles     = {{'name':'Name', 'flag_shared':'Share', 'total_nodes':'Total Node', 'total_cpus':'Total CPU', 'avail_nodes':'Avail Node', 'avail_cpus':'Avail CPU','pending_jobs':'PENDING JOB', 'running_jobs':'RUNNING JOB'}}
    displayData (pending_jobs, j_titles, '#pending_jobs');
    displayData (partitions,   p_titles, '#partitions');

    function displayData (data, titles_dict, div_id) {{
	var sortAscending = true;
	var table         = d3.select(div_id).append('table');
        var firstKey      = Object.keys(titles_dict)[0]
	//var titles        = d3.keys(data[0]);

	var headers = table.append('thead')
                           .append('tr')
		           .selectAll('th')
		           .data(Object.keys(titles_dict)).enter()
		           .append('th')
		           .text(function (d) {{ return titles_dict[d]; }})
		           .on('click', function (d) {{
                               console.log ('on click ' + d)
		               headers.attr('class', 'header');
		                	   
		               if (sortAscending) {{
		                  rows.sort(function(a, b) {{
                                      console.log('cmp ' + d + ' value ' + JSON.stringify(b[d]) + '<' + JSON.stringify(a[d])); 
                                      if (a[d] == b[d]) {{console.log('ret ' + (b[firstKey]<a[firstKey])); return b[firstKey]<a[firstKey];}} 
                                      else {{console.log('ret ' + (b[d]<a[d])); return b[d] < a[d];}} }});
		                  sortAscending  = false;
		                  this.className = 'aes';
		               }} else {{
		                  rows.sort(function(a, b) {{ if (b[d] == a[d]) {{return b[firstKey]>a[firstKey];}} else {{return b[d] > a[d];}} }});
		                  sortAscending  = true;
		                  this.className = 'des';
		               }}
		                	   
		            }});
		  
	var rows = table.append('tbody').selectAll('tr')
		               .data(data).enter()
		               .append('tr');
	rows.selectAll('td')
	    .data(function (d) {{
		return Object.keys(titles_dict).map(function (k) {{
		    return {{ 'value': d[k], 'name': k}};
		}});
	    }}).enter()
	    .append('td')
	    .attr('data-th', function (d) {{
		    	return d.name;
	    }})
	    .html(function (d) {{
                 if (d.name == 'user') {{
                    return '<a href=./userDetails?user=' + d.value+'>' + d.value + '</a>'
                 }}
		 return d.value;
	    }});
    }};
</script>
</body>

</html>
