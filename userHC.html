<!doctype HTML>
<html>
    <head>
	<script type="text/javascript" src="static/scripts/jquery-2.1.3.min.js"></script>
	<script type="text/javascript" src="static/scripts/highcharts.js"></script>
	<script type="text/javascript" src="static/scripts/annotations.js"></script>
	<script type="text/javascript" src="static/scripts/exporting.js"></script>
	<script type="text/javascript">
	 function graphSeries(series, chartTag, title, yCap, aSeries, aUnit) {

             function crtLabel (vx, vy, v) {
                return {
                      point: {
                          xAxis: 0,
                          yAxis: 0,
                          x    : vx,
                          y    : vy
                      },
                      text: v.toString().concat(aUnit) }
             }

             if ( aSeries.length > 0 ) {
                cus_labels = aSeries.map(function(x) {return crtLabel(x[1], x[2], x[0])})
                console.log(cus_labels)
                cus_anno = [{
                   labelOptions: {
                        backgroundColor: 'rgba(255,255,255,0.5)',
                    },
                    labels: cus_labels
                 }]
             } else
                cus_anno = []

	     $('#'+chartTag).highcharts({
		 chart: {
		     panKey: 'shift',
		     panning: true,
		     type:   'scatter',
		     zoomType: 'xy'
		 },
		 title: {
		     text: title,
		 },
		 credits: {
		     enabled: false,
		 },
		 subtitle: {
		     text: document.ontouchstart === undefined ?
                     'Click and drag in the plot area to zoom in. Shift-click to pan.' : 'Pinch the chart to zoom in'
		 },
                 annotations: cus_anno,
		 xAxis: {
		     type: 'datetime'
		 },
		 yAxis: {
		     title: {
			 text: yCap
		     }
		 },
		 legend: {
		     enabled: true
		 },
                 plotOptions: {
                     scatter: {
                         marker: { radius: 2, },
                     },
                     tooltip: {
                             pointFormatter: function() {
                                 return '<br/>' + Highcharts.dateFormat('%%H:%%M', new Date(this.x)) + ': ' + this.y.toFixed(2);
                             }
                     },

                 },
		 series: series
	     });
	 }
	 Highcharts.setOptions({
             global: {
		 useUTC: false
             }
	 });
	</script>
    </head>
    <body>
	<div id="chart1" style="min-width: 1000px; height: 400px; margin: 0 auto"></div>
	<hr>
	<div id="chart2" style="min-width: 1000px; height: 400px; margin: 0 auto"></div>
	<hr>
	<div id="chart3" style="min-width: 1000px; height: 400px; margin: 0 auto"></div>
	<hr>
	<script>
	 graphSeries(%(series1)s, "chart1",  "%(title1)s from %(start)s to %(stop)s", "%(xlabel1)s",  %(aseries1)s, " cores");
	 graphSeries(%(series2)s, "chart2",  "%(title2)s from %(start)s to %(stop)s", "%(xlabel2)s",  %(aseries2)s, " MB");
	 graphSeries(%(series3)s, "chart3",  "%(title3)s from %(start)s to %(stop)s", "%(xlabel3)s",  %(aseries3)s, " cores");
	</script>
</html>
